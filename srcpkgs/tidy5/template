# Template file for 'tidy5'
# This project has an identity crisis, it's "Tidy",
# "HTML Tidy" and "Tidy HTML5". Binaries are tidy5.
pkgname=tidy5
_reponame=tidy-html5
version=5.1.7
revision=1
wrksrc=${_reponame}-${version}
build_style=cmake
cmake_builddir=build/cmake
hostmakedepends="cmake libxslt"
short_desc="HTML Tidy with HTML5 support"
maintainer="beefcurtains <beefcurtains@voidlinux.eu>"
license="W3C"
homepage="http://www.htacg.org/tidy-html5/"
distfiles="https://github.com/htacg/${_reponame}/archive/${version}.tar.gz"
checksum=6e4c51a2393298a3b233a02ec262c818da2aa335c3c55a8e6a1d66a8970e7733

pre_configure() {
	# the $(man) target requires tidy5 to run on the host
	ln -s ${cmake_builddir}/${pkgname}
	if [ -n "$CROSS_BUILD" ]; then
		rm ${pkgname}
		cd ${cmake_builddir}

		env - PATH=/usr/bin cmake -DBUILD_SHARED_LIB:BOOL=FALSE ${wrksrc}
		make ${makejobs} ${pkgname}

		cp ${pkgname} ${wrksrc}
		cd ${wrksrc}
		rm -rf ${cmake_builddir}
	fi
}

post_install() {
	vlicense LICENSE.txt LICENSE
}

libtidy5_package() {
	short_desc+=" - library files"
	pkg_install() {
		vmove "usr/lib/*.so.*"
	}
}

libtidy5-devel_package() {
	depends="libtidy5>=${version}_${revision}"
	short_desc+=" - development files"
	pkg_install() {
		vmove usr/include
		vmove "usr/lib/*.a"
		vmove "usr/lib/*.so"
	}
}
